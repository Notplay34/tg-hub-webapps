# Обзор модулей и ИИ — что работает и что добавить по делу

Кратко: как выглядит каждый модуль и какие доработки реально полезны (без «фич ради фич»).

---

## ИИ-ассистент

**Как устроено:**  
Пользователь пишет в чат. Сообщение сначала разбирается парсером команд (`parse_user_command`): если фраза совпадает с шаблонами — действие выполняется сразу (создать задачу, отметить выполненной, добавить/обновить контакт, один сценарий для базы знаний). Иначе запрос уходит в LLM с контекстом: задачи, люди, знания, финансы за месяц, последние операции, цели.

**Плюсы:**  
- Удобно: «купить молоко на завтра», «выполнено купить молоко», «добавь контакт Иванов Иван 01.01.1990 компаньон» — действительно создаются задачи и контакты.  
- Контекст для ИИ хороший: видит и задачи, и людей, и финансы.  
- Есть сжатие длинной истории, команды «забудь про …» и «новый диалог».

**Минусы и что поправить:**

1. **Промпт врёт про действия.**  
   В системном промпте написано: «НИКОГДА не говори, что создал задачу — ты этого не умеешь» и «Если просят создать задачу — скажи: Напиши: создай задачу …».  
   На самом деле бэкенд уже создаёт задачу по «создай задачу …» и возвращает `action_executed: true`. В итоге модель может ответить «напиши создай задачу», хотя задача уже создана.  
   **Что сделать:** в промпте явно описать: при командах вида «создай задачу / добавь контакт / выполнено …» система сама выполняет действие; если в ответе пришло, что действие выполнено, ассистент должен коротко подтвердить («Задача создана», «Контакт добавлен»), а не просить «написать команду».

2. **Финансы и заметки в чате не выполняются.**  
   В подсказках в интерфейсе написано: «добавь расход 1500 на еду сегодня», «создай финансовую цель отпуск 200000», «добавь заметку про встречу».  
   Для финансов и «добавь заметку» в `parse_user_command` нет шаблонов, в `execute_ai_action` нет вызовов API — только ответ текстом. Пользователь ожидает действие, а получает совет.  
   **Что сделать (по приоритету):**  
   - Добавить разбор фраз типа «добавь расход 500 на еду [сегодня]», «доход 3000 зарплата» и вызов создания транзакции в `execute_ai_action` — тогда голосовой/быстрый ввод расходов из чата будет реально работать.  
   - Опционально: «создай цель …» / «добавь цель …» с суммой — создание цели через API.  
   - Для базы знаний: либо добавить шаблон «добавь заметку …» / «добавь в базу …» и вызывать уже существующий `create_knowledge`, либо убрать из подсказок формулировки про создание заметок из чата и оставить только советы.

3. **Лимиты не в контексте.**  
   В контекст для ИИ попадают доход/расход/баланс за месяц, последние операции и цели. Лимитов по категориям нет.  
   **Что сделать:** подтягивать лимиты и факт «потрачено по категории» за текущий месяц и добавлять в системный промпт; тогда ассистент сможет говорить «ты уже превысил лимит по еде» или «осталось 2 тыс по транспорту».

Итого по ИИ: выровнять промпт с реальными действиями, добавить выполнение «добавь расход/доход» (и при желании целей и заметок), дать ИИ данные по лимитам.

---

## Задачи

**Как есть:** список, фильтры (все / сегодня / завтра / неделя / месяц / готово), сортировка, дедлайн, приоритет, повтор (daily/weekly/monthly в форме), напоминания через бота, привязка к человеку, таймлайн изменений.

**Что добавить по делу:**  
- На главном экране уже есть «актуальные задачи» и кнопка «+». Если хочется ускорить ввод: одна строка быстрого добавления «что сделать» с дефолтом «сегодня» (без открытия модалки) — опционально.  
- Подзадачи/чеклисты в задаче — только если реально используешь; иначе лишняя сложность.  
Итого: модуль сильный, критичных дыр нет; доработки — по ощущению от использования.

---

## Картотека (люди)

**Как есть:** карточки с полями, группы, связи между людьми, заметки с датами, связь с задачами и базой знаний.

**Что добавить по делу:**  
- С карточки человека удобно перейти к «задачам, связанным с ним» (уже есть связь по `person_id`). На фронте можно добавить блок «Задачи» на экране карточки: список задач с этим `person_id` и кнопка «добавить задачу» с уже подставленным человеком.  
- Поиск по ФИО и группам уже есть; если начнёшь хранить телефон/email — поиск по ним в карточке будет логичным.  
Без лишних фич: достаточно «задачи по этому человеку» на карточке.

---

## База знаний

**Как есть:** записи с заголовком, текстом, тегами, привязка к человеку, поиск и фильтры по тегам.

**Что добавить по делу:**  
- На карточке человека уже есть связь с знаниями; на экране просмотра записи базы знаний показывать «связанный человек» и переход в его карточку — симметрия и быстрый контекст.  
- Если в чате оставить подсказки про «добавь заметку» — тогда в парсере команд нужна фраза «добавь заметку …» / «добавь в базу …» и вызов `create_knowledge`, иначе пользователь будет вводить команду зря.  
Итого: либо «заметка из чата» делается по-настоящему, либо не обещаем это в UI.

---

## Финансы

**Как есть:** доход/расход/сбережения, цели (сбережения / из остатка), лимиты по категориям, сводка по месяцам, перенос остатка, одна лента операций с редактированием и удалением.

**Что добавить по делу:**  
- **Из чата:** разбирать «добавь расход/доход …» и реально создавать транзакции (см. ИИ выше) — это самая полезная доработка.  
- В форме добавления операции можно подсказать категории: выпадающий список или чипы из уже использованных категорий за последние месяцы — меньше опечаток и единообразие для лимитов.  
- Опционально: на экране финансов одна строка «Лимиты: X из Y по категориям» со ссылкой в модалку лимитов — чтобы не забывать про них.  
Без «фич ради фич»: приоритет — команды из чата и подсказка категорий.

---

## Сводная таблица

| Модуль   | Оценка | Главное добавить |
|----------|--------|-------------------|
| ИИ       | Сильный контекст, команды по задачам/людям работают | Выровнять промпт с действиями; «добавь расход/доход» из чата; лимиты в контексте |
| Задачи   | Всё нужное есть | По желанию: быстрый ввод одной строкой на главной |
| Люди     | Удобно | Блок «Задачи» на карточке человека |
| Знания   | Норм   | Связь «запись → человек» в UI; команда «добавь заметку» из чата или убрать из подсказок |
| Финансы  | Цели и лимиты закрыты | Команды расход/доход из чата; подсказка категорий в форме операции |

Если выбирать один приоритет на весь продукт: **сделать так, чтобы «добавь расход …» и «добавь доход …» в чате реально создавали транзакции** — это и голосовой ввод упростит, и обещания в подсказках чата станут честными.

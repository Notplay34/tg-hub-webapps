<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Hub</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app">
        <!-- ===== –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ===== -->
        <section class="screen active" id="statsScreen">
            <header class="header">
                <h1>YouHub</h1>
            </header>
            
            <div class="search-bar-fake" onclick="GlobalSearch.open()">
                <span class="search-bar-icon">üîç</span>
                <span class="search-bar-placeholder">–ü–æ–∏—Å–∫...</span>
            </div>
            
            <div class="header-subtitle">
                <span>–ê–∫—Ç—É–∞–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏</span>
                <button class="btn-add-small" onclick="Tasks.openModal()">+</button>
            </div>
            
            <main class="content" id="todayContent">
                <div class="pull-refresh" id="todayPullRefresh">
                    <div class="pull-refresh-icon">‚Üì</div>
                    <div>–ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div id="todayList"></div>
            </main>
            <div class="empty" id="todayEmpty">–ù–µ—Ç –∑–∞–¥–∞—á –Ω–∞ —Å–µ–≥–æ–¥–Ω—è</div>
        </section>

        <!-- ===== –ì–õ–û–ë–ê–õ–¨–ù–´–ô –ü–û–ò–°–ö ===== -->
        <section class="screen" id="searchScreen">
            <header class="header">
                <button class="btn-back" onclick="GlobalSearch.close()">‚Üê</button>
                <h1>–ü–æ–∏—Å–∫</h1>
            </header>
            
            <div class="search-box-large">
                <div class="search-icon">üîç</div>
                <input type="text" id="globalSearchInput" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∑–∞–¥–∞—á–∞–º, –ª—é–¥—è–º, –∑–Ω–∞–Ω–∏—è–º..." autofocus oninput="GlobalSearch.search()">
            </div>
            
            <main class="content search-results" id="searchResults">
                <div class="search-placeholder">
                    <div class="search-placeholder-icon">üîç</div>
                    <p>–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞</p>
                </div>
            </main>
        </section>

        <!-- ===== –ó–ê–î–ê–ß–ò ===== -->
        <section class="screen" id="tasksScreen">
            <header class="header">
                <h1>–ó–∞–¥–∞—á–∏</h1>
                <button class="btn-icon" onclick="Tasks.openModal()">+</button>
            </header>
            
            <div class="header-actions">
                <button class="btn-sort" onclick="Tasks.toggleSort()">
                    –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: <span id="tasksSortLabel">–ü–æ –¥–∞—Ç–µ</span> ‚ñº
                </button>
            </div>
            
            <nav class="filters" id="tasksFilters">
                <button class="filter active" data-filter="all">–í—Å–µ</button>
                <button class="filter" data-filter="today">–°–µ–≥–æ–¥–Ω—è</button>
                <button class="filter" data-filter="tomorrow">–ó–∞–≤—Ç—Ä–∞</button>
                <button class="filter" data-filter="week">–ù–µ–¥–µ–ª—è</button>
                <button class="filter" data-filter="month">–ú–µ—Å—è—Ü</button>
                <button class="filter" data-filter="done">–ì–æ—Ç–æ–≤–æ</button>
            </nav>
            
            <main class="content" id="tasksContent">
                <div class="pull-refresh" id="tasksPullRefresh">
                    <div class="pull-refresh-icon">‚Üì</div>
                    <div>–ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div id="tasksList"></div>
            </main>
            <div class="empty" id="tasksEmpty">–ù–µ—Ç –∑–∞–¥–∞—á</div>
            <div class="loading" id="tasksLoading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="error" id="tasksError" style="display:none">
                <p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                <button onclick="Tasks.retry()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            </div>
        </section>

        <!-- ===== –õ–Æ–î–ò ===== -->
        <section class="screen" id="peopleScreen">
            <header class="header">
                <h1>–ö–∞—Ä—Ç–æ—Ç–µ–∫–∞</h1>
                <button class="btn-icon" onclick="People.openModal()">+</button>
            </header>
            
            <div class="search-box">
                <input type="text" id="peopleSearch" placeholder="–ü–æ–∏—Å–∫..." oninput="People.render()">
            </div>
            
            <nav class="filters" id="peopleFilters"></nav>
            
            <main class="content" id="peopleContent">
                <div class="pull-refresh" id="peoplePullRefresh">
                    <div class="pull-refresh-icon">‚Üì</div>
                    <div>–ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div id="peopleList"></div>
            </main>
            <div class="empty" id="peopleEmpty">–ö–∞—Ä—Ç–æ—Ç–µ–∫–∞ –ø—É—Å—Ç–∞</div>
            <div class="loading" id="peopleLoading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="error" id="peopleError" style="display:none">
                <p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                <button onclick="People.retry()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            </div>
        </section>

        <!-- ===== –ö–ê–†–¢–û–ß–ö–ê –ß–ï–õ–û–í–ï–ö–ê ===== -->
        <section class="screen" id="personScreen">
            <header class="header">
                <button class="btn-back" onclick="People.closeCard()">‚Üê</button>
                <h1 id="personName">–ò–º—è</h1>
                <button class="btn-icon edit" onclick="People.edit()">‚úé</button>
            </header>
            <main class="content" id="personCard"></main>
        </section>

        <!-- ===== –ë–ê–ó–ê –ó–ù–ê–ù–ò–ô ===== -->
        <section class="screen" id="knowledgeScreen">
            <header class="header">
                <h1>–ë–∞–∑–∞ –∑–Ω–∞–Ω–∏–π</h1>
                <button class="btn-icon" onclick="Knowledge.openModal()">+</button>
            </header>
            
            <div class="search-box">
                <input type="text" id="knowledgeSearch" placeholder="–ü–æ–∏—Å–∫..." oninput="Knowledge.render()">
            </div>
            
            <nav class="filters" id="knowledgeFilters"></nav>
            
            <main class="content" id="knowledgeContent">
                <div class="pull-refresh" id="knowledgePullRefresh">
                    <div class="pull-refresh-icon">‚Üì</div>
                    <div>–ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div id="knowledgeList"></div>
            </main>
            <div class="empty" id="knowledgeEmpty">–ë–∞–∑–∞ –ø—É—Å—Ç–∞</div>
            <div class="loading" id="knowledgeLoading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="error" id="knowledgeError" style="display:none">
                <p>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</p>
                <button onclick="Knowledge.retry()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
            </div>
        </section>

        <!-- ===== TIMELINE ===== -->
        <section class="screen" id="timelineScreen">
            <header class="header">
                <h1>Timeline</h1>
            </header>
            
            <main class="content timeline-content" id="timelineContent">
                <div class="pull-refresh" id="timelinePullRefresh">
                    <div class="pull-refresh-icon">‚Üì</div>
                    <div>–ü–æ—Ç—è–Ω–∏—Ç–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è</div>
                </div>
                <div id="timelineList"></div>
            </main>
            <div class="empty" id="timelineEmpty">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π</div>
            <div class="loading" id="timelineLoading">‚è≥ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
        </section>

        <!-- ===== –ò–ò –ê–°–°–ò–°–¢–ï–ù–¢ ===== -->
        <section class="screen" id="aiScreen">
            <header class="header">
                <h1>–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
                <button class="btn-icon" onclick="AI.clearHistory()" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é">üóë</button>
            </header>
            
            <main class="chat-container" id="chatContainer">
                <div class="chat-welcome">
                    <div class="ai-avatar">ü§ñ</div>
                    <p>–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç.<br>–°–ø—Ä–æ—Å–∏ –º–µ–Ω—è –æ –∑–∞–¥–∞—á–∞—Ö, –ª—é–¥—è—Ö –∏–ª–∏ –∑–Ω–∞–Ω–∏—è—Ö.</p>
                </div>
                <div class="chat-messages" id="chatMessages"></div>
            </main>
            
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="–°–ø—Ä–æ—Å–∏—Ç—å..." onkeydown="if(event.key==='Enter')AI.send()">
                <button class="btn-send" onclick="AI.send()">‚Üí</button>
            </div>
        </section>

        <!-- ===== –ù–ê–í–ò–ì–ê–¶–ò–Ø ===== -->
        <nav class="bottom-nav">
            <button class="nav-item active" data-screen="statsScreen">
                <span class="nav-icon">üè†</span>
                <span class="nav-label">–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            <button class="nav-item" data-screen="tasksScreen">
                <span class="nav-icon">üìã</span>
                <span class="nav-label">–ó–∞–¥–∞—á–∏</span>
            </button>
            <button class="nav-item" data-screen="peopleScreen">
                <span class="nav-icon">üë§</span>
                <span class="nav-label">–õ—é–¥–∏</span>
            </button>
            <button class="nav-item" data-screen="knowledgeScreen">
                <span class="nav-icon">üìö</span>
                <span class="nav-label">–ë–∞–∑–∞</span>
            </button>
            <button class="nav-item" data-screen="timelineScreen">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-label">Timeline</span>
            </button>
            <button class="nav-item" data-screen="aiScreen">
                <span class="nav-icon">ü§ñ</span>
                <span class="nav-label">–ò–ò</span>
            </button>
        </nav>

        <!-- ===== –ú–û–î–ê–õ–¨–ù–´–ï –û–ö–ù–ê ===== -->
        
        <!-- –ó–∞–¥–∞—á–∞ -->
        <div class="modal" id="taskModal">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="modal-close" onclick="Tasks.closeModal()">√ó</button>
                    <h2 id="taskModalTitle">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h2>
                    <button class="btn-save" onclick="Tasks.save()">‚úì</button>
                </div>
                <form id="taskForm" onsubmit="return false">
                    <input type="hidden" id="taskId">
                    <div class="form-group">
                        <input type="text" id="taskTitle" placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?" required>
                    </div>
                    <div class="form-group">
                        <textarea id="taskDesc" rows="2" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>–î–µ–¥–ª–∞–π–Ω</label>
                            <input type="date" id="taskDeadline">
                        </div>
                        <div class="form-group">
                            <label>–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç</label>
                            <select id="taskPriority">
                                <option value="low">–ù–∏–∑–∫–∏–π</option>
                                <option value="medium" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                                <option value="high">–í—ã—Å–æ–∫–∏–π</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>–°–≤—è–∑–∞—Ç—å —Å —á–µ–ª–æ–≤–µ–∫–æ–º</label>
                        <select id="taskPerson">
                            <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî</option>
                        </select>
                    </div>
                </form>
                <button class="btn-delete" id="taskDelete" onclick="Tasks.delete()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ß–µ–ª–æ–≤–µ–∫ -->
        <div class="modal" id="personModal">
            <div class="modal-content modal-full">
                <div class="modal-header">
                    <button class="modal-close" onclick="People.closeModal()">√ó</button>
                    <h2 id="personModalTitle">–ù–æ–≤—ã–π –∫–æ–Ω—Ç–∞–∫—Ç</h2>
                    <button class="btn-save" onclick="People.save()">‚úì</button>
                </div>
                <form id="personForm" onsubmit="return false">
                    <input type="hidden" id="personId">
                    
                    <div class="form-section">
                        <div class="form-group">
                            <label>–§–ò–û *</label>
                            <input type="text" id="personFio" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
                                <input type="date" id="personBirth">
                            </div>
                            <div class="form-group">
                                <label>–ö–µ–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è</label>
                                <input type="text" id="personRelation" placeholder="–î—Ä—É–≥, –∫–æ–ª–ª–µ–≥–∞">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>–ú–µ—Å—Ç–æ —Ä–∞–±–æ—Ç—ã</label>
                            <input type="text" id="personWork" placeholder="–ö–æ–º–ø–∞–Ω–∏—è">
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞</h3>
                        <div class="form-group">
                            <label>–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</label>
                            <textarea id="personStrengths" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã</label>
                            <textarea id="personWeaknesses" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>–í–æ–∑–º–æ–∂–Ω–∞—è –ø–æ–ª—å–∑–∞</label>
                            <textarea id="personBenefits" rows="2"></textarea>
                        </div>
                        <div class="form-group">
                            <label>–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã</label>
                            <textarea id="personProblems" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h3>–ì—Ä—É–ø–ø—ã</h3>
                        <div class="tags-container">
                            <div class="tags-list" id="personGroupsList"></div>
                            <input type="text" id="personGroupInput" placeholder="+ –≥—Ä—É–ø–ø–∞" onkeydown="if(event.key==='Enter'){event.preventDefault();People.addGroup()}">
                        </div>
                    </div>
                </form>
                <button class="btn-delete" id="personDelete" onclick="People.delete()">–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç</button>
            </div>
        </div>

        <!-- –ó–∞–º–µ—Ç–∫–∞ –∫ —á–µ–ª–æ–≤–µ–∫—É -->
        <div class="modal" id="noteModal">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="modal-close" onclick="People.closeNoteModal()">√ó</button>
                    <h2>–ù–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞</h2>
                    <button class="btn-save" onclick="People.saveNote()">‚úì</button>
                </div>
                <div class="form-group">
                    <textarea id="noteText" rows="4" placeholder="–ó–∞–º–µ—Ç–∫–∞..."></textarea>
                </div>
            </div>
        </div>

        <!-- –ó–Ω–∞–Ω–∏–µ -->
        <div class="modal" id="knowledgeModal">
            <div class="modal-content modal-full">
                <div class="modal-header">
                    <button class="modal-close" onclick="Knowledge.closeModal()">√ó</button>
                    <h2 id="knowledgeModalTitle">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
                    <button class="btn-save" onclick="Knowledge.save()">‚úì</button>
                </div>
                <form id="knowledgeForm" onsubmit="return false">
                    <input type="hidden" id="knowledgeId">
                    <div class="form-group">
                        <input type="text" id="knowledgeTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫" required>
                    </div>
                    <div class="form-group">
                        <textarea id="knowledgeContent" rows="8" placeholder="–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>–°–≤—è–∑–∞—Ç—å —Å —á–µ–ª–æ–≤–µ–∫–æ–º</label>
                        <select id="knowledgePerson">
                            <option value="">‚Äî –ù–µ –≤—ã–±—Ä–∞–Ω–æ ‚Äî</option>
                        </select>
                    </div>
                    <div class="form-section">
                        <h3>–¢–µ–≥–∏</h3>
                        <div class="tags-container">
                            <div class="tags-list" id="knowledgeTagsList"></div>
                            <input type="text" id="knowledgeTagInput" placeholder="+ —Ç–µ–≥" onkeydown="if(event.key==='Enter'){event.preventDefault();Knowledge.addTag()}">
                        </div>
                    </div>
                </form>
                <button class="btn-delete" id="knowledgeDelete" onclick="Knowledge.delete()">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>

        <!-- –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–Ω–∞–Ω–∏—è -->
        <div class="modal" id="knowledgeViewModal">
            <div class="modal-content">
                <div class="modal-header">
                    <button class="modal-close" onclick="Knowledge.closeView()">√ó</button>
                    <h2 id="knowledgeViewTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
                    <button class="btn-icon edit" onclick="Knowledge.editCurrent()">‚úé</button>
                </div>
                <div class="view-content" id="knowledgeViewContent"></div>
                <div class="view-meta" id="knowledgeViewMeta"></div>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="app.js"></script>
</body>
</html>
